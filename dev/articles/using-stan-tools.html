<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How to use primarycensored with Stan • primarycensored</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to use primarycensored with Stan">
<meta name="description" content="A guide on how to use primarycensored with Stan.">
<meta property="og:description" content="A guide on how to use primarycensored with Stan.">
<meta property="og:image" content="https://primarycensored.epinowcast.org/logo.png">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">primarycensored</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/primarycensored.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference">
<li><a class="dropdown-item" href="../reference/index.html">R reference</a></li>
    <li><a class="dropdown-item" href="https://primarycensored.epinowcast.org/stan/">Stan reference</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>──── First steps ────</h6></li>
    <li><a class="dropdown-item" href="../articles/primarycensored.html">Getting started</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>──── Methodology ────</h6></li>
    <li><a class="dropdown-item" href="../articles/why-it-works.html">Why it works</a></li>
    <li><a class="dropdown-item" href="../articles/analytic-solutions.html">Analytic solutions for censored delay distributions</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>──── Fitting delay distributions ────</h6></li>
    <li><a class="dropdown-item" href="../articles/fitting-dists-with-stan.html">Fitting distributions using primarycensored and cmdstan</a></li>
    <li><a class="dropdown-item" href="../articles/fitting-dists-with-fitdistrplus.html">Fitting distributions using primarycensored and fitdistrplus</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>──── Stan development ────</h6></li>
    <li><a class="dropdown-item" href="../articles/using-stan-tools.html">How to use primarycensored with Stan</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/primarycensored/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>How to use primarycensored with Stan</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/primarycensored/blob/main/vignettes/using-stan-tools.Rmd" class="external-link"><code>vignettes/using-stan-tools.Rmd</code></a></small>
      <div class="d-none name"><code>using-stan-tools.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="introduction">
<span class="header-section-number">1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3" number="1.1">
<h3 id="what-are-we-going-to-do-in-this-vignette">
<span class="header-section-number">1.1</span> What are we going to do in this vignette<a class="anchor" aria-label="anchor" href="#what-are-we-going-to-do-in-this-vignette"></a>
</h3>
<p>In this vignette, we’ll explore how to use the <code>primarycensored</code> package in your Stan modelling workflow. We’ll cover the following key points:</p>
<ol style="list-style-type: decimal">
<li>Introduction to Stan and its relevance for our analysis</li>
<li>Overview of the packages we’ll be using</li>
<li>How to access and use Stan functions provided by <code>primarycensored</code>
</li>
<li>Methods for integrating these Stan functions into your workflow</li>
</ol>
<p>If you are instead interested in fitting a delay distribution using <code>primarycensored</code> in R see the <code><a href="../articles/fitting-dists-with-stan.html">vignette("fitting-dists-with-stan")</a></code> vignette or <a href="https://epidist.epinowcast.org" class="external-link"><code>epidist</code></a> package (which uses <code>primarycensored</code> under the hood).</p>
</div>
<div class="section level3" number="1.2">
<h3 id="what-is-stan-and-why-are-we-using-it">
<span class="header-section-number">1.2</span> What is Stan and why are we using it<a class="anchor" aria-label="anchor" href="#what-is-stan-and-why-are-we-using-it"></a>
</h3>
<p>Stan is a probabilistic programming language for statistical inference. It provides a flexible and efficient platform for Bayesian modeling and is widely used in various fields of data science and statistics. In this vignette, we’ll use Stan in conjunction with <code>primarycensored</code> to perform Bayesian inference on censored data.</p>
<p>For more information on Stan:</p>
<ul>
<li><a href="https://mc-stan.org/" class="external-link">Stan’s official website</a></li>
<li><a href="https://mc-stan.org/users/documentation/" class="external-link">Stan documentation</a></li>
<li>
<a href="https://discourse.mc-stan.org/" class="external-link">Stan forums</a> for community support and discussions</li>
</ul>
</div>
<div class="section level3" number="1.3">
<h3 id="packages-used-in-this-vignette">
<span class="header-section-number">1.3</span> Packages used in this vignette<a class="anchor" aria-label="anchor" href="#packages-used-in-this-vignette"></a>
</h3>
<p>Alongside the <code>primarycensored</code> package we will use the <code>cmdstanr</code> package for interfacing with cmdstan.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://primarycensored.epinowcast.org">primarycensored</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/cmdstanr/" class="external-link">cmdstanr</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2" number="2">
<h2 id="using-stan-code-in-primarycensored">
<span class="header-section-number">2</span> Using Stan code in primarycensored<a class="anchor" aria-label="anchor" href="#using-stan-code-in-primarycensored"></a>
</h2>
<p><code>primarycensored</code> includes a set of Stan functions that mirror the R functions in <code>primarycensored</code>. Documentation for these functions can be found <a href="https://primarycensored.epinowcast.org/stan/">here</a>. We support a range of approaches to integrate this Stan code into your workflow.</p>
<div class="section level3" number="2.1">
<h3 id="checking-available-stan-functions-using-pcd_stan_functions">
<span class="header-section-number">2.1</span> Checking available Stan functions using <code>pcd_stan_functions()</code><a class="anchor" aria-label="anchor" href="#checking-available-stan-functions-using-pcd_stan_functions"></a>
</h3>
<p>Aside from reading the documentation it is also possible to list the available Stan functions using a helper function directly in R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pcd_stan_functions.html">pcd_stan_functions</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "expgrowth_pdf"                         </span></span>
<span><span class="co">##  [2] "expgrowth_lpdf"                        </span></span>
<span><span class="co">##  [3] "expgrowth_cdf"                         </span></span>
<span><span class="co">##  [4] "expgrowth_lcdf"                        </span></span>
<span><span class="co">##  [5] "expgrowth_rng"                         </span></span>
<span><span class="co">##  [6] "check_for_analytical"                  </span></span>
<span><span class="co">##  [7] "primarycensored_gamma_uniform_lcdf"    </span></span>
<span><span class="co">##  [8] "primarycensored_lognormal_uniform_lcdf"</span></span>
<span><span class="co">##  [9] "log_weibull_g"                         </span></span>
<span><span class="co">## [10] "primarycensored_weibull_uniform_lcdf"  </span></span>
<span><span class="co">## [11] "primarycensored_analytical_lcdf"       </span></span>
<span><span class="co">## [12] "primarycensored_analytical_cdf"        </span></span>
<span><span class="co">## [13] "dist_lcdf"                             </span></span>
<span><span class="co">## [14] "primary_lpdf"                          </span></span>
<span><span class="co">## [15] "primarycensored_ode"                   </span></span>
<span><span class="co">## [16] "primarycensored_cdf"                   </span></span>
<span><span class="co">## [17] "primarycensored_lcdf"                  </span></span>
<span><span class="co">## [18] "primarycensored_lpmf"                  </span></span>
<span><span class="co">## [19] "primarycensored_pmf"                   </span></span>
<span><span class="co">## [20] "primarycensored_sone_lpmf_vectorized"  </span></span>
<span><span class="co">## [21] "primarycensored_sone_pmf_vectorized"</span></span></code></pre>
</div>
<div class="section level3" number="2.2">
<h3 id="accessing-stan-functions">
<span class="header-section-number">2.2</span> Accessing Stan functions<a class="anchor" aria-label="anchor" href="#accessing-stan-functions"></a>
</h3>
<p>Stan functions are accessed using the <code><a href="../reference/pcd_load_stan_functions.html">pcd_load_stan_functions()</a></code> function. This function takes the name of the function as an argument and returns the function as a string. It can additionally write the functions to a file and wrap them in a <code>functions{}</code> block.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pcd_load_stan_functions.html">pcd_load_stan_functions</a></span><span class="op">(</span><span class="st">"primarycensored_lpmf"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "// Stan functions from primarycensored version 1.1.0.1000\nreal primarycensored_lpmf(data int d, int dist_id, array[] real params,\n                                data real pwindow, data real d_upper,\n                                data real D, int primary_id,\n                                array[] real primary_params) {\n  if (d_upper &gt; D) {\n    reject(\"Upper truncation point is greater than D. It is \", d_upper,\n           \" and D is \", D, \". Resolve this by increasing D to be greater or equal to d + swindow or decreasing swindow.\");\n  }\n  if (d_upper &lt;= d) {\n    reject(\"Upper truncation point is less than or equal to d. It is \", d_upper,\n           \" and d is \", d, \". Resolve this by increasing d to be less than d_upper.\");\n  }\n  real log_cdf_upper = primarycensored_lcdf(\n    d_upper | dist_id, params, pwindow, positive_infinity(), primary_id, primary_params\n  );\n  real log_cdf_lower = primarycensored_lcdf(\n    d | dist_id, params, pwindow, positive_infinity(), primary_id, primary_params\n  );\n  if (!is_inf(D)) {\n    real log_cdf_D;\n\n    if (d_upper == D) {\n      log_cdf_D = log_cdf_upper;\n    } else {\n      log_cdf_D = primarycensored_lcdf(\n        D | dist_id, params, pwindow, positive_infinity(), primary_id, primary_params\n      );\n    }\n    return log_diff_exp(log_cdf_upper, log_cdf_lower) - log_cdf_D;\n  } else {\n    return log_diff_exp(log_cdf_upper, log_cdf_lower);\n  }\n}"</span></span></code></pre>
</div>
<div class="section level3" number="2.3">
<h3 id="linking-the-stan-functions-to-your-workflow">
<span class="header-section-number">2.3</span> Linking the Stan functions to your workflow<a class="anchor" aria-label="anchor" href="#linking-the-stan-functions-to-your-workflow"></a>
</h3>
<div class="section level4" number="2.3.1">
<h4 id="writing-functions-to-a-file">
<span class="header-section-number">2.3.1</span> Writing functions to a file<a class="anchor" aria-label="anchor" href="#writing-functions-to-a-file"></a>
</h4>
<p>One option for using Stan functions is to write them to a file and then compile them using <code>cmdstanr</code>. This is a good approach as it means that once the functions are written they can be used in the same way as any other stan functions you might use. The downside is that it may mean more work keeping up to date with changes to the functions. We can do this using the <code><a href="../reference/pcd_load_stan_functions.html">pcd_load_stan_functions()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expgrowth_rng_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"expgrowth_rng.stan"</span><span class="op">)</span></span>
<span><span class="va">exp_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcd_load_stan_functions.html">pcd_load_stan_functions</a></span><span class="op">(</span></span>
<span>  <span class="st">"expgrowth_rng"</span>,</span>
<span>  write_to_file <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output_file <span class="op">=</span> <span class="va">expgrowth_rng_file</span>,</span>
<span>  wrap_in_block <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Stan functions written to: /tmp/RtmphYCziv/expgrowth_rng.stan</span></span></code></pre>
<p>This can now be compiled and used in the same way as any other <code>cmdstanr</code> model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/cmdstan_model.html" class="external-link">cmdstan_model</a></span><span class="op">(</span><span class="va">expgrowth_rng_file</span><span class="op">)</span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## functions {</span></span>
<span><span class="co">## // Stan functions from primarycensored version 1.1.0.1000</span></span>
<span><span class="co">## real expgrowth_rng(real min, real max, real r) {</span></span>
<span><span class="co">##   real u = uniform_rng(0, 1);</span></span>
<span><span class="co">##   if (abs(r) &lt; 1e-10) {</span></span>
<span><span class="co">##     return min + u * (max - min);</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">##   return min + log(u * (exp(r * max) - exp(r * min)) + exp(r * min)) / r;</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## }</span></span></code></pre>
<p>Alternatively, you could use <code>#include expgrowth_rng.stan</code> in a stan file functions block to include the function along with the path to that file as with any other stan file (see <a href="https://mc-stan.org/cmdstanr/reference/model-method-compile.html" class="external-link">here</a>).</p>
</div>
<div class="section level4" number="2.3.2">
<h4 id="including-the-functions-directly-via-include_paths">
<span class="header-section-number">2.3.2</span> Including the functions directly via <code>include_paths</code><a class="anchor" aria-label="anchor" href="#including-the-functions-directly-via-include_paths"></a>
</h4>
<p>Rather than writing the functions to a file it is also possible to include them directly in the stan file using the <code>include_paths</code> argument to <code><a href="https://mc-stan.org/cmdstanr/reference/cmdstan_model.html" class="external-link">cmdstan_model()</a></code>. This is useful if you don’t to clutter your model with the stan code from <code>primarycensored</code> and want automatic updating of the functions. To demonstrate we will first write a small model has has <code>expgrowth.stan</code> in its include paths (rather than writing it to a file and then including it). The first step is find the file and path for the <code>expgrowth_rng</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pcd_stan_files.html">pcd_stan_files</a></span><span class="op">(</span><span class="st">"expgrowth_rng"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "expgrowth.stan"</span></span></code></pre>
<p>With that done we now write stan wrapper model.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expgrowth_stan_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"expgrowth.stan"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span></span>
<span>  text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"functions {"</span>,</span>
<span>    <span class="st">"#include expgrowth.stan"</span>,</span>
<span>    <span class="st">"}"</span>,</span>
<span>    <span class="st">"generated quantities {"</span>,</span>
<span>    <span class="st">"  real y = expgrowth_rng(0, 1, 0.4);"</span>,</span>
<span>    <span class="st">"}"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">expgrowth_stan_file</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can now use this file to compile a model. <strong>Note</strong> that we need to include the path to the <code>primarycensored</code> Stan functions using the <code>include_paths</code> argument to <code><a href="https://mc-stan.org/cmdstanr/reference/cmdstan_model.html" class="external-link">cmdstan_model()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/cmdstan_model.html" class="external-link">cmdstan_model</a></span><span class="op">(</span><span class="va">expgrowth_stan_file</span>, include_paths <span class="op">=</span> <span class="fu"><a href="../reference/pcd_stan_path.html">pcd_stan_path</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## functions {</span></span>
<span><span class="co">## #include expgrowth.stan</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## generated quantities {</span></span>
<span><span class="co">##   real y = expgrowth_rng(0, 1, 0.4);</span></span>
<span><span class="co">## }</span></span></code></pre>
<p>We can then sample from the model (we set <code>fixed_param = TRUE</code> here as our toy example doesn’t require MCMC sampling).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>chains <span class="op">=</span> <span class="fl">1</span>, fixed_param <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running MCMC with 1 chain...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 Iteration:   1 / 1000 [  0%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 100 / 1000 [ 10%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 200 / 1000 [ 20%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 300 / 1000 [ 30%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 400 / 1000 [ 40%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 500 / 1000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span></span></code></pre></div>
<pre><code><span><span class="co">##  variable mean median   sd  mad   q5  q95 rhat ess_bulk ess_tail</span></span>
<span><span class="co">##         y 0.52   0.54 0.29 0.37 0.06 0.95 1.00      979      802</span></span></code></pre>
</div>
</div>
<div class="section level3" number="2.4">
<h3 id="using-stan-functions-directly-in-r">
<span class="header-section-number">2.4</span> Using Stan functions directly in R<a class="anchor" aria-label="anchor" href="#using-stan-functions-directly-in-r"></a>
</h3>
<p>Whilst it is possible to use Stan functions directly in R it is not recommended for most use cases (use the R functions in <code>primarycensored</code> instead). However, it can be useful to understand what is going on under the hood or for exploration (indeed we use this internally in <code>primarycensored</code> to check our functions against the R implementations). To do this we use the <code>expose_functions()</code> method on our already compiled model. <strong>This can take some time (~30 seconds) to compile all of the functions.</strong></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">expose_functions</span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We can now use the function in R. Note that this may get slightly more complicated if our stan function depends on other stan functions (i.e. you need to have those included in your compiled model as well).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">expgrowth_rng</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.1772395</span></span></code></pre>
</div>
<div class="section level3" number="2.5">
<h3 id="summary">
<span class="header-section-number">2.5</span> Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>In this vignette we have shown approaches for using the Stan functions provided by <code>primarycensored</code> in your Stan modelling workflow. We have also shown how to use the <code>expose_functions()</code> method to access the Stan functions directly in R for exploration and testing.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Sam Brand, James Mba Azam, Carl Pearson, Sebastian Funk, Kelly Charniga.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
