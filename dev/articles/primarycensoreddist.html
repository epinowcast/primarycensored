<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with primarycensoreddist • primarycensoreddist</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with primarycensoreddist">
<meta name="description" content="A quick start example demonstrating use of primarycensoreddist.">
<meta property="og:description" content="A quick start example demonstrating use of primarycensoreddist.">
<meta property="og:image" content="https://primarycensoreddist.epinowcast.org/logo.png">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">primarycensoreddist</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/primarycensoreddist.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference">
<li><a class="dropdown-item" href="../reference/index.html">R reference</a></li>
    <li><a class="dropdown-item" href="https://primarycensoreddist.epinowcast.org/stan/">Stan reference</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/stan.html">Fitting distributions using primarycensorseddist and cmdstan</a></li>
    <li><a class="dropdown-item" href="../articles/fitdistr.html">Fitting distributions using primarycensorseddist and fitdistr</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/primarycensoreddist/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Getting Started with primarycensoreddist</h1>
                        <h4 data-toc-skip class="author">Sam Abbott</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/primarycensoreddist/blob/main/vignettes/primarycensoreddist.Rmd" class="external-link"><code>vignettes/primarycensoreddist.Rmd</code></a></small>
      <div class="d-none name"><code>primarycensoreddist.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="introduction">
<span class="header-section-number">1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Delay distributions play a crucial role in various fields, including epidemiology, reliability analysis, and survival analysis. These distributions describe the time between two events of interest, such as the incubation period of a disease or the time to failure of a component. Accurately estimating and calculating these distributions is essential for understanding the underlying processes and making informed decisions<span class="citation"><sup>[<a href="#ref-Charniga2024">1</a>]</sup></span>. However, estimating these distributions can be challenging due to various factors, including censoring and truncation of the observed data<span class="citation"><sup>[<a href="#ref-Park2024">2</a>]</sup></span>.</p>
<p>The estimation of delay distributions often faces the following challenges:</p>
<ul>
<li><p><strong>Primary event censoring</strong>: The primary event (e.g., exposure to a pathogen or the start of a process) is often observed with some degree of interval censoring. This means that the exact time of the event is not known, but rather, it is known to have occurred within a certain time interval, commonly a day. As a result, any distribution based on these primary events is a combination of the underlying true distribution and the censoring distribution.</p></li>
<li><p><strong>Truncation</strong>: The observation of delay distributions is often conditioned on the occurrence of the secondary event. This leads to a truncation of the observed distribution, as delays longer than the observation time are not captured in the data. Consequently, the observed distribution is a combination of the underlying true distribution, the censoring distribution, and the observation time.</p></li>
<li><p><strong>Secondary event censoring</strong>: The secondary event (e.g., symptom onset or the end of a process) is also frequently observed with interval censoring. This additional layer of censoring further complicates the estimation of the delay distribution.</p></li>
</ul>
<p>The <code>primarycensoreddist</code> package aims to address these challenges by providing tools to manipulate primary censored delay distributions. By accounting for the censoring and truncation present in the data, the package enables more accurate estimation and use of the underlying true distribution.</p>
<p>In this vignette, we will provide a quick introduction to the main functions and concepts in the <code>primarycensoreddist</code> package. We will cover the mathematical formulation of the problem, demonstrate the usage of the key functions, and provide signposting on how to learn more.</p>
</div>
<div class="section level2" number="2">
<h2 id="packages-in-this-getting-started-vignette-">
<span class="header-section-number">2</span> Packages in this getting started vignette.<a class="anchor" aria-label="anchor" href="#packages-in-this-getting-started-vignette-"></a>
</h2>
<p>As well as the <code>primarycensoreddist</code> package this vignette also uses <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://primarycensoreddist.epinowcast.org">primarycensoreddist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># Set seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="3">
<h2 id="generating-random-samples-with-rprimarycensoreddist">
<span class="header-section-number">3</span> Generating Random Samples with <code>rprimarycensoreddist()</code><a class="anchor" aria-label="anchor" href="#generating-random-samples-with-rprimarycensoreddist"></a>
</h2>
<p>This function generates random samples from a primary event censored distribution. It adjusts the distribution by accounting for the primary event distribution, potential truncation at a maximum delay (D), and secondary event censoring.</p>
<p>The mathematical formulation for generating random samples from a primary event censored distribution is as follows:</p>
<ol style="list-style-type: decimal">
<li>Generate primary event times (<span class="math inline">\(p\)</span>) from the specified primary event distribution (<span class="math inline">\(f_p\)</span>) within the primary event window (<span class="math inline">\(pwindow\)</span>):</li>
</ol>
<p><span class="math display">\[p \sim f_p(x), \quad 0 \leq x \leq pwindow\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>Generate delays (<span class="math inline">\(d\)</span>) from the specified delay distribution (<span class="math inline">\(f_d\)</span>) with parameters <span class="math inline">\(\theta\)</span>:</li>
</ol>
<p><span class="math display">\[d \sim f_d(x; \theta)\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li>Calculate the total delays (<span class="math inline">\(t\)</span>) by adding the primary event times and the delays:</li>
</ol>
<p><span class="math display">\[t = p + d\]</span></p>
<ol start="4" style="list-style-type: decimal">
<li>Round the total delays to the nearest secondary event window (<span class="math inline">\(swindow\)</span>):</li>
</ol>
<p><span class="math display">\[t_{rounded} = \lfloor \frac{t}{swindow} \rfloor \times swindow\]</span></p>
<ol start="5" style="list-style-type: decimal">
<li>Apply truncation to ensure that the delays are within the specified range <span class="math inline">\([0, D]\)</span>:</li>
</ol>
<p><span class="math display">\[t_{valid} = \{t_{rounded} \mid 0 \leq t_{rounded} &lt; D\}\]</span></p>
<p>Here’s an example of how to use <code><a href="../reference/rprimarycensoreddist.html">rprimarycensoreddist()</a></code> to sample from a log-normal distribution with and without secondary interval censoring. For simplicity we will use a daily secondary censoring window for both events.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e4</span></span>
<span><span class="va">meanlog</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">sdlog</span> <span class="op">&lt;-</span> <span class="fl">0.75</span></span>
<span><span class="va">obs_time</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">pwindow</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Random samples without secondary censoring</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rprimarycensoreddist.html">rprimarycensoreddist</a></span><span class="op">(</span></span>
<span>  <span class="va">n</span>, <span class="va">rlnorm</span>,</span>
<span>  meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span>,</span>
<span>  pwindow <span class="op">=</span> <span class="va">pwindow</span>, swindow <span class="op">=</span> <span class="fl">0</span>, D <span class="op">=</span> <span class="va">obs_time</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Random samples with secondary censoring</span></span>
<span><span class="va">samples_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rprimarycensoreddist.html">rprimarycensoreddist</a></span><span class="op">(</span></span>
<span>  <span class="va">n</span>, <span class="va">rlnorm</span>,</span>
<span>  meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span>,</span>
<span>  pwindow <span class="op">=</span> <span class="va">pwindow</span>, swindow <span class="op">=</span> <span class="fl">1</span>, D <span class="op">=</span> <span class="va">obs_time</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Calculate the PMF for the samples with secondary censoring</span></span>
<span><span class="va">samples_sc_pmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  pmf <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">samples_sc</span><span class="op">)</span> <span class="op">/</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">samples_sc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Compare the samples with and without secondary censoring to the true</span></span>
<span><span class="co"># distribution</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>samples <span class="op">=</span> <span class="va">samples</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">samples</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#4292C6"</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"#252525"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">samples_sc_pmf</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">pmf.samples_sc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="va">pmf.Freq</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#20b986"</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"#252525"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>    just <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">geom_function</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="va">dlnorm</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#252525"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparison of Samples from Log-Normal Distribution"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Samples"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Blue density: Samples without secondary censoring\n"</span>,</span>
<span>      <span class="st">"Green bars: Samples with secondary censoring\n"</span>,</span>
<span>      <span class="st">"Black line: True log-normal distribution without truncation"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="primarycensoreddist_files/figure-html/sample-lognormal-1.png" width="672"></p>
<p>Neither distribution matches the true distribution due to the truncation at <code>D</code> which biases both observed distributions towards shorter delays and the primary and secondary event censoring.</p>
</div>
<div class="section level2" number="4">
<h2 id="compute-the-primary-event-censored-cumulative-distribution-function-cdf-for-delays-with-pprimarycensoreddist">
<span class="header-section-number">4</span> Compute the primary event censored cumulative distribution function (CDF) for delays with <code>pprimarycensoreddist()</code><a class="anchor" aria-label="anchor" href="#compute-the-primary-event-censored-cumulative-distribution-function-cdf-for-delays-with-pprimarycensoreddist"></a>
</h2>
<p>This function computes the primary event censored cumulative distribution function (CDF) for a given set of quantiles. It adjusts the CDF of delay distribution by accounting for the primary event distribution and potential truncation at a maximum delay (D).</p>
<p>The primary event censored CDF, (<span class="math inline">\(F_{\text{cens}}(q)\)</span>), is given by:</p>
<p><span class="math display">\[
F_{\text{cens}}(q) = \int_{0}^{pwindow} F(q - p) \cdot f_{\text{primary}}(p) \, dp
\]</span></p>
<p>where (<span class="math inline">\(F\)</span>) is the CDF of the primary event distribution, (<span class="math inline">\(f_{\text{primary}}\)</span>) is the PDF of the primary event times, and (<span class="math inline">\(pwindow\)</span>) is the primary event window.</p>
<p>If the maximum delay (<span class="math inline">\(D\)</span>) is finite, the CDF is normalized by (<span class="math inline">\(F(D)\)</span>):</p>
<p><span class="math display">\[
F_{\text{cens}}(q) = \int_{0}^{pwindow} \frac{F(q - p)}{F(D - p)} \cdot f_{\text{primary}}(p) \, dp
\]</span></p>
<p>Let’s compare the empirical CDF of our samples without secondary censoring to the theoretical CDF computed using <code><a href="../reference/pprimarycensoreddist.html">pprimarycensoreddist()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empirical_cdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html" class="external-link">ecdf</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span>
<span><span class="va">theoretical_cdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pprimarycensoreddist.html">pprimarycensoreddist</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">obs_time</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  <span class="va">plnorm</span>,</span>
<span>  meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span>,</span>
<span>  pwindow <span class="op">=</span> <span class="va">pwindow</span>, D <span class="op">=</span> <span class="va">obs_time</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a data frame for plotting</span></span>
<span><span class="va">cdf_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">obs_time</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  Theoretical <span class="op">=</span> <span class="va">theoretical_cdf</span>,</span>
<span>  Empirical <span class="op">=</span> <span class="fu">empirical_cdf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">obs_time</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the empirical and theoretical CDFs</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cdf_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Theoretical</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Empirical</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#4292C6"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparison of Empirical and Theoretical CDFs"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Delay"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative Probability"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Blue line: Empirical CDF from samples without secondary censoring\n"</span>,</span>
<span>      <span class="st">"Black line: Theoretical CDF computed using pprimarycensoreddist()"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="primarycensoreddist_files/figure-html/cdf-lognormal-1.png" width="672"></p>
<p>The theoretical CDF matches the empirical CDF very well, confirming that <code><a href="../reference/pprimarycensoreddist.html">pprimarycensoreddist()</a></code> is working as expected.</p>
</div>
<div class="section level2" number="5">
<h2 id="compute-the-primary-event-censored-probability-mass-function-pmfwith-dprimarycensoreddist">
<span class="header-section-number">5</span> Compute the primary event censored probability mass function (PMF)with <code>dprimarycensoreddist()</code><a class="anchor" aria-label="anchor" href="#compute-the-primary-event-censored-probability-mass-function-pmfwith-dprimarycensoreddist"></a>
</h2>
<p>This function computes the primary event censored probability mass function (PMF) for a given set of quantiles using the CDF. On top of accounting for the primary event distribution and truncation it also accounts for secondary event censoring.</p>
<p>The primary event censored PMF, (<span class="math inline">\(f_{\text{cens}}(d)\)</span>), is given by:</p>
<p><span class="math display">\[
f_{\text{cens}}(d) = F_{\text{cens}}(d + \text{swindow}) - F_{\text{cens}}(d)
\]</span></p>
<p>where (<span class="math inline">\(F_{\text{cens}}\)</span>) is the potentially right truncated primary event censored CDF and (<span class="math inline">\(\text{swindow}\)</span>) is the secondary event window.</p>
<p>Let’s compare the empirical PMF of our samples with secondary censoring to the theoretical PMF computed using <code><a href="../reference/dprimarycensoreddist.html">dprimarycensoreddist()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the theoretical PMF using dprimarycensoreddist</span></span>
<span><span class="va">theoretical_pmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dprimarycensoreddist.html">dprimarycensoreddist</a></span><span class="op">(</span></span>
<span>  <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">obs_time</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">plnorm</span>,</span>
<span>  meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span>,</span>
<span>  pwindow <span class="op">=</span> <span class="va">pwindow</span>, swindow <span class="op">=</span> <span class="fl">1</span>, D <span class="op">=</span> <span class="va">obs_time</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pmf_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">obs_time</span>,</span>
<span>  pmf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theoretical_pmf</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the empirical and theoretical PMFs</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">samples_sc_pmf</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">pmf.samples_sc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="va">pmf.Freq</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#20b986"</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"#252525"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>    just <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">pmf_df</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">pmf</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparison of Samples from Log-Normal Distribution"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Samples"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Green bars: Empirical PMF from samples with secondary censoring\n"</span>,</span>
<span>      <span class="st">"Black line: Theoretical PMF computed using dprimarycensoreddist()"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="primarycensoreddist_files/figure-html/pmf-lognormal-1.png" width="672"></p>
<p>Again the theoretical PMF matches the empirical PMF very well, confirming that <code><a href="../reference/dprimarycensoreddist.html">dprimarycensoreddist()</a></code> is also working as expected.</p>
</div>
<div class="section level2" number="6">
<h2 id="other-key-functionality">
<span class="header-section-number">6</span> Other key functionality<a class="anchor" aria-label="anchor" href="#other-key-functionality"></a>
</h2>
<p>In addition to these main functions, the package also includes:</p>
<ul>
<li><p><strong>Primary event distributions:</strong> The package includes commonly used primary event distributions such as exponential growth.</p></li>
<li><p><strong>Stan versions of all functions and R functions to interface with Stan:</strong> All R functions have a corresponding Stan function. These Stan functions are used in the estimation of delay distributions using the Stan software. The package also includes tools to manipulate the Stan code in R.</p></li>
</ul>
</div>
<div class="section level2" number="7">
<h2 id="learning-more">
<span class="header-section-number">7</span> Learning more<a class="anchor" aria-label="anchor" href="#learning-more"></a>
</h2>
<ul>
<li>For more on <code>primarycensoreddist</code> see the other package vignettes and the function documentation.</li>
<li>For more methodological background on delay distributions see Park et al.<span class="citation"><sup>[<a href="#ref-Park2024">2</a>]</sup></span>.</li>
<li>For advice on best practices when estimating or handling delay distributions see Charniga et al.<span class="citation"><sup>[<a href="#ref-Charniga2024">1</a>]</sup></span>.</li>
</ul>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-Charniga2024" class="csl-entry">
1. Charniga, K., Park, S. W., Akhmetzhanov, A. R., Cori, A., Dushoff, J., Funk, S., Gostic, K. M., Linton, N. M., Lison, A., Overton, C. E., Pulliam, J. R. C., Ward, T., Cauchemez, S., &amp; Abbott, S. (2024). Best practices for estimating and reporting epidemiological delay distributions of infectious diseases using public health surveillance and healthcare data. <em>arXiv [Stat.ME]</em>. <a href="https://arxiv.org/abs/2405.08841" class="external-link">https://arxiv.org/abs/2405.08841</a>
</div>
<div id="ref-Park2024" class="csl-entry">
2. Park, S. W., Akhmetzhanov, A. R., Charniga, K., Cori, A., Davies, N. G., Dushoff, J., Funk, S., Gostic, K., Grenfell, B., Linton, N. M., Lipsitch, M., Lison, A., Overton, C. E., Ward, T., &amp; Abbott, S. (2024). Estimating epidemiological delay distributions for infectious diseases. <em>bioRxiv</em>. <a href="https://doi.org/10.1101/2024.01.12.24301247" class="external-link">https://doi.org/10.1101/2024.01.12.24301247</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
