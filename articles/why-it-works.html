<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Why it works • primarycensoreddist</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Why it works">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">primarycensoreddist</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/primarycensoreddist.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference">
<li><a class="dropdown-item" href="../reference/index.html">R reference</a></li>
    <li><a class="dropdown-item" href="https://primarycensoreddist.epinowcast.org/stan/">Stan reference</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/using-stan-tools.html">How to use primarycensoreddist with Stan</a></li>
    <li><a class="dropdown-item" href="../articles/fitting-dists-with-stan.html">Fitting distributions using primarycensorseddist and cmdstan</a></li>
    <li><a class="dropdown-item" href="../articles/fitting-dists-with-fitdistrplus.html">Fitting distributions using primarycensorseddist and fitdistrplus</a></li>
    <li><a class="dropdown-item" href="../articles/why-it-works.html">Why it works</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/primarycensoreddist/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Why it works</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/primarycensoreddist/blob/main/vignettes/why-it-works.Rmd" class="external-link"><code>vignettes/why-it-works.Rmd</code></a></small>
      <div class="d-none name"><code>why-it-works.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="introduction">
<span class="header-section-number">1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3" number="1.1">
<h3 id="what-are-we-going-to-do-in-this-vignette">
<span class="header-section-number">1.1</span> What are we going to do in this Vignette<a class="anchor" aria-label="anchor" href="#what-are-we-going-to-do-in-this-vignette"></a>
</h3>
<p>In this vignette, we’ll explain the underlying statistical model that the <code>primarycensoreddist</code> package. We’ll cover the following key points:</p>
<ol style="list-style-type: decimal">
<li>Introduction to the censored data problems in time to event analysis.</li>
<li>Discuss the relevant issues from censoring in epidemiological data.</li>
<li>Introduce the statistical model used in <code>primarycensoreddist</code>.</li>
<li>Distributions where we can derive the censored delay distribution analytically.</li>
</ol>
</div>
</div>
<div class="section level2" number="2">
<h2 id="censoring-and-right-truncation-problems-in-time-to-event-analysis">
<span class="header-section-number">2</span> Censoring and right truncation problems in time to event analysis<a class="anchor" aria-label="anchor" href="#censoring-and-right-truncation-problems-in-time-to-event-analysis"></a>
</h2>
<p>Time to event analysis, also known as survival analysis, concerns estimating the distribution of delay times between events. A distinctive feature of the field are the methodological techniques used to deal with the missing data problems common in data sets of delay times<span class="citation"><sup>[<a href="#ref-leung1997censoring">1</a>]</sup></span>. In <code>primarycensoreddist</code> we focus on two particular missing data problems:</p>
<ul>
<li>
<strong>Interval censoring</strong>. The primary (start) time and/or the secondary (end) time of the delay are unobserved but both are known to be within intervals.</li>
<li>
<strong>Right truncation</strong>. Truncated delay data items are only reported if their secondary events are less than a known time, for example the current data collection time.</li>
</ul>
<p>In statistical epidemiology, these missing data problems occur frequently in both data analysis and theoretical modelling. For a more detailed description of these problems in an epidemiological context see<span class="citation"><sup>[<a href="#ref-Park2024">2</a>,<a href="#ref-Charniga2024">3</a>]</sup></span>.</p>
<p>In data analysis, events in epidemiology are commonly reported as occurring on a particular day or week (<em>interval censoring</em>). In an emerging outbreak, datasets can be incompletely observed (<em>right truncation</em>) and their can be a great deal of uncertainty around the precise timing of events (<em>interval censoring</em>).</p>
<p>In theoretical epidemiological modelling, it is often appropriate to model the evolution of an infectious disease as occurring in discrete time, for example in the <a href="https://epiforecasts.io/EpiNow2/" class="external-link"><code>EpiNow2</code></a> and <a href="https://mrc-ide.github.io/EpiEstim/index.html" class="external-link">EpiEstim</a> modelling packages. This means appropriately discretising continuous distributions, such as the generation interval distribution. In <code>primarycensoreddist</code> we treat the discretisation of intrinsically continuous distributions as an <em>interval censoring</em> problem which allows us to simultaneously provide methods for both applied and theoretical contexts.</p>
</div>
<div class="section level2" number="3">
<h2 id="statistical-model-used-in-primarycensoreddist">
<span class="header-section-number">3</span> Statistical model used in <code>primarycensoreddist</code><a class="anchor" aria-label="anchor" href="#statistical-model-used-in-primarycensoreddist"></a>
</h2>
<p>As described in <a href="primarycensoreddist.html">Getting Started with <code>primarycensoreddist</code></a>, <code>primarycensoreddist</code> focuses on a subset of methods from time to event analysis that address data missingness problems commonly found in epidemiological datasets. We present the statistical problem as a double interval censoring problem, where both the primary event time and the secondary event times are interval censored. We can recover single interval censoring problems by reducing one of the intervals to a point. In particular, a key assumption we make is that the censoring window for events is known and independent of the event time. This is known as non-informative censoring.</p>
<p>The target for inference is the distribution of the delay time between the primary and secondary events. We assume that the delay time is a random variable <span class="math inline">\(T = S - P_{u}\)</span> with distribution function <span class="math inline">\(F_T(t) = Pr(T &lt; t)\)</span> and density function <span class="math inline">\(f_T(t)\)</span>. In this treatment we assume that the delay time is shift-invariant, that is, the distribution of the delay time is the same regardless of the primary event time.</p>
<p>The (unconditional) primary event time is a random variable <span class="math inline">\(P_{u}\)</span> with distribution function <span class="math inline">\(F_{P_{u}}(t)\)</span> and density function <span class="math inline">\(f_{P_{u}}(t)\)</span>. The secondary event time is a random variable <span class="math inline">\(S\)</span>, but in this treatment we construct the secondary event time from the primary time and delay, therefore the marginal distribution of <span class="math inline">\(S\)</span> is not considered.</p>
<p>The <em>censoring window</em> for each event is the interval within which each event is known to have occurred, respectively, <span class="math inline">\(P \in [t_P, t_P + w_P]\)</span> and <span class="math inline">\(S \in [t_S, t_S + w_S]\)</span>. The lengths of the censoring windows are <span class="math inline">\(w_P\)</span> and <span class="math inline">\(w_S\)</span> respectively. The precise event times within their windows are unobserved. Note that since the primary event time is known up to the censoring window, we are predominantly interested in the <em>conditional</em> primary time <span class="math inline">\(P = P_{u} | \{ P_{u} \in [t_P, t_P + w_P]\}\)</span> which has density function:</p>
<p><span class="math display">\[
\begin{aligned}
f_{P}(p) &amp;= {f_{P_{u}}(p) \over F_{P_{u}}(t_P + w_P) - F_{P_{u}}(t_P)}, \qquad &amp;p \in [t_P, t_P + w_P],\\
f_{P}(p) &amp;= 0, \qquad &amp;\text{otherwise}.
\end{aligned}
\]</span></p>
<p>We measure the <em>censored delay time</em> <span class="math inline">\(T_c\)</span> between the primary and secondary event windows from endpoint to endpoint: <span class="math inline">\(T_c = t_S + w_S - (t_P + w_P)\)</span>.</p>
<p>In our treatment below we focus on the <a href="https://en.wikipedia.org/wiki/Survival_function" class="external-link">survival function</a> of the time after the end of the primary window to the secondary event time which we denote <span class="math inline">\(S_{+}\)</span>. We then use this to derive the distribution of the censored delay time <span class="math inline">\(T_c\)</span>. This is equivalent to, but differ in mathematical approach from other treatments of the censoring problems in epidemiology, such as<span class="citation"><sup>[<a href="#ref-Park2024">2</a>]</sup></span>.</p>
<div class="section level3" number="3.1">
<h3 id="censored-delay-time-distribution">
<span class="header-section-number">3.1</span> Censored delay time distribution<a class="anchor" aria-label="anchor" href="#censored-delay-time-distribution"></a>
</h3>
<p>In this section, we explain how to derive the distribution of the censored delay time <span class="math inline">\(T_c\)</span> from the distribution of the delay time <span class="math inline">\(T\)</span> and the condition distribution of the primary event time <span class="math inline">\(P\)</span>.</p>
<div class="section level4" number="3.1.1">
<h4 id="survival-function-of-time-from-the-end-of-the-primary-censoring-window-to-the-secondary-event-time">
<span class="header-section-number">3.1.1</span> Survival function of time from the end of the primary censoring window to the secondary event time<a class="anchor" aria-label="anchor" href="#survival-function-of-time-from-the-end-of-the-primary-censoring-window-to-the-secondary-event-time"></a>
</h4>
<p>In order to reason upon the distribution of the censored delay time <span class="math inline">\(T_c\)</span>, it is useful to consider the time from the end (right) point of the primary censoring interval to the secondary time as a random variable,</p>
<p><span class="math display">\[
S_+ = S - (t_P + w_P) = T - ((t_P + w_P) - P) = T - C_P.
\]</span></p>
<p>Where <span class="math inline">\(T\)</span> is the delay distribution of interest and <span class="math inline">\(C_P = (t_P + w_P) - P\)</span> is interval between the end (right) point of the primary censoring window and the primary event time; note that by definition <span class="math inline">\(C_P\)</span> is not observed but we can relate its distribution to the distribution of <span class="math inline">\(P\)</span>: <span class="math inline">\(F_{C_P}(p) = Pr(C_P &lt; p) = Pr(P &gt; t_P + w_P - p)\)</span>.</p>
<p>With non-informative censoring, it is possible to derive the upper distribution function of <span class="math inline">\(S_+\)</span>, or <a href="https://en.wikipedia.org/wiki/Survival_function" class="external-link"><em>survival function</em></a> of <span class="math inline">\(S_+\)</span>, from the distribution of <span class="math inline">\(T\)</span> and the distribution of <span class="math inline">\(C_P\)</span>.</p>
<p><span class="math display">\[
\begin{equation}
\begin{split}
Q_{S_+}(t) &amp;= Pr(S_+ &gt; t) \\
&amp;= Pr(T &gt; C_P + t) \\
&amp;= \mathbb{E}_{C_P} \Big[Q_T(t + C_P)\Big] \\
&amp;= \int_0^{w_P} Q_T(t + p) f_{C_P}(p) dp.
\end{split}
\end{equation}
\]</span></p>
<p>Using <a href="https://en.wikipedia.org/wiki/Integration_by_parts" class="external-link">integration by parts</a> gives:
<span class="math display" id="eq:survivalfunc">\[
Q_{S_+}(t) = Q_T(t + w_P) + \int_0^{w_P} f_T(t+p) F_{C_P}(p) dp. \tag{3.1}
\]</span></p>
<p>Where we have used that <span class="math inline">\(Q^{'}_{T} = - f_T\)</span>, <span class="math inline">\(Q_T\)</span> is the survival function of the actual delay distribution of interest and <span class="math inline">\(w_P\)</span> is the length of the primary censoring window.</p>
<p>Equation <a href="#eq:survivalfunc">(3.1)</a> is the key equation in this note and is used to derive the distribution of the censored delay time <span class="math inline">\(T_c\)</span>. It has the interpretation that the probability that the secondary event time is greater than <span class="math inline">\(t\)</span> after the end of the primary censoring window is the sum of two disjoint event probabilities:</p>
<ol style="list-style-type: decimal">
<li>The probability that the <em>actual</em> delay time <span class="math inline">\(T\)</span> is greater than <span class="math inline">\(t + w_P\)</span>.</li>
<li>The probability that the <em>actual</em> delay time <span class="math inline">\(T\)</span> is between <span class="math inline">\(t\)</span> and <span class="math inline">\(t + w_P\)</span>, and the primary event time <span class="math inline">\(P\)</span> occurred sufficiently close to the end of the primary censor window that the secondary even occurred more than time <span class="math inline">\(t\)</span> after the end of the primary window.</li>
</ol>
</div>
<div class="section level4" number="3.1.2">
<h4 id="probability-of-secondary-event-time-within-a-secondary-censoring-window">
<span class="header-section-number">3.1.2</span> Probability of secondary event time within a secondary censoring window<a class="anchor" aria-label="anchor" href="#probability-of-secondary-event-time-within-a-secondary-censoring-window"></a>
</h4>
<p>Having constructed the survival function of <span class="math inline">\(S_+\)</span> with equation <a href="#eq:survivalfunc">(3.1)</a>, using numerical quadrature or in some other way, we can calculate the probability mass of a secondary event time falling within a observed secondary censoring window of length <span class="math inline">\(w_S\)</span> that begins at time <span class="math inline">\(n\)</span> <em>after</em> the primary censoring window. This gives the censored delay time probability <a href="https://mc-stan.org/docs/stan-users-guide/truncation-censoring.html#integrating-out-censored-values" class="external-link">by integrating over censored values</a>:</p>
<p><span class="math display" id="eq:seccensorprob">\[
Pr(S_+ \in [n, n + w_S)) = Q_{S_+}(n) - Q_{S_+}(n + w_S). \tag{3.2}
\]</span></p>
<p>Note that the censored secondary event time can also occur within the primary censoring window. This happens with probability,
<span class="math display">\[
Q_{S_+}(-w_P) - Q_{S_+}(0) = 1 - Q_T(w_P) - \int_0^{w_P} f_T(p) F_{C_P}(p) dp = Pr(T&lt; C).
\]</span></p>
</div>
<div class="section level4" number="3.1.3">
<h4 id="discrete-censored-delay-distribution">
<span class="header-section-number">3.1.3</span> Discrete censored delay distribution<a class="anchor" aria-label="anchor" href="#discrete-censored-delay-distribution"></a>
</h4>
<p>A common situation is when every primary and secondary event window is a single time unit, <span class="math inline">\(w_P = w_S = 1\)</span>, and data arrives in non-overlapping intervals. For example, in the context of infectious disease modelling, we might have a data set of symptom onsets (primary event) and time of seeking health care (secondary event) which are both reported in days.</p>
<p>In this situation, we are interested in the probability of censored delays <span class="math inline">\(T_c\)</span> in units of the event window. In this case equation <a href="#eq:seccensorprob">(3.2)</a> is:</p>
<p><span class="math display" id="eq:disccensprob">\[
f_n = Pr(T_c = n) = Pr(S_+ \in [n - 1, n)) = Q_{S_+}(n-1) - Q_{S_+}(n )\qquad n = 0, 1, \dots. \tag{3.3}
\]</span></p>
<p>Which is a discrete probability mass function of the secondary event time relative to the primary event time in units of the event window.</p>
</div>
</div>
<div class="section level3" number="3.2">
<h3 id="analytic-solutions-for-exponentially-tilted-primary-event-times">
<span class="header-section-number">3.2</span> Analytic solutions for exponentially tilted primary event times<a class="anchor" aria-label="anchor" href="#analytic-solutions-for-exponentially-tilted-primary-event-times"></a>
</h3>
<p>In epidemiological analysis, it is common for primary events to be arriving at exponentially increasing or decreasing rates, for example, incidence of new infections in a growing epidemic. In this case, the distribution of the primary event time within its censoring window is biased by the exponential growth or decay. If we assume a reference uniform distribution within a primary censoring window <span class="math inline">\([k, k + w_P)\)</span> then the distribution of the primary event time within the censoring window is the exponential tilted uniform distribution:</p>
<p><span class="math display">\[
f_P(t) \propto \exp(r t) \mathbb{1}_{[k, k + w_P]}(t).
\]</span></p>
<p>In this case, the distribution function for <span class="math inline">\(C_P\)</span>, that is the length of time left in the primary censor window <em>after</em> the primary event time, is given by:</p>
<p><span class="math display" id="eq:fcp">\[
F_{C_P}(p; r) = {  1 - \exp(-r p) \over 1 - \exp(-r w_P)}, \qquad p \in [0, w_P]. \tag{3.4}
\]</span>
Note that taking the limit <span class="math inline">\(\lim_r \rightarrow 0\)</span> in equation <a href="#eq:fcp">(3.4)</a> gives the uniform distribution function <span class="math inline">\(F_{C_P}(p, 0) = p / w_P\)</span>.</p>
<p>In the following it is convenient to use a (linear) difference operator defined as:</p>
<p><span class="math display">\[
\Delta_{w}f(t) = f(t + w) - f(t).
\]</span></p>
<div class="section level4" number="3.2.1">
<h4 id="uniform-primary-event-time-r0">
<span class="header-section-number">3.2.1</span> Uniform primary event time (<span class="math inline">\(r=0\)</span>)<a class="anchor" aria-label="anchor" href="#uniform-primary-event-time-r0"></a>
</h4>
<p>Applying a uniform primary event time distribution to equation <a href="#eq:survivalfunc">(3.1)</a> gives:</p>
<p><span class="math display">\[
Q_{S_+}(t) = Q_T(t + w_P) + { 1 \over w_P} \int_0^{w_P} f_T(t+p) p~ dp.
\]</span></p>
<p>This is analytically solvable whenever the upper distribution function of <span class="math inline">\(T\)</span> is known and the mean of <span class="math inline">\(T\)</span> is analytically solvable from its integral definition.</p>
<p>In each case considered below it is easier to change the integration variable:</p>
<p><span class="math display" id="eq:unifprim">\[
\begin{aligned}
Q_{S_+}(t) &amp;= Q_T(t + w_P) + { 1 \over w_P} \int_t^{t+w_P} f_T(z) (z-t)~ dz \\
&amp;= Q_T(t + w_P) + { 1 \over w_P} \Big[  \int_t^{t+w_P} f_T(z) z~ dz - t \Delta_{w_P}F_T(t) \Big].
\end{aligned} \tag{3.5}
\]</span></p>
<p><strong>General partial expectation</strong></p>
<p>Note that for any distribution with an analytically available distribution function <span class="math inline">\(F_T\)</span> equation <a href="#eq:unifprim">(3.5)</a> can be solved so long as the <em>partial expectation</em></p>
<p><span class="math display" id="eq:partexp">\[
\int_t^{t+w_P} f_T(z) z~ dz \tag{3.6}
\]</span></p>
<p>can be reduced to an analytic expression.</p>
<p>The insight here is that this will be possible for any distribution where the average of the distribution can be calculated analytically, which includes commonly used non-negative distributions such as the Gamma, Log-Normal and Weibull distributions.</p>
<p><strong>General Discrete censored delay distribution</strong></p>
<p>First, we note that equation <a href="#eq:disccensprob">(3.3)</a> can be written using the difference operator: <span class="math inline">\(f_n = -\Delta_1 Q_{S_+}(n-1)\)</span>. We can insert this expression into equation <a href="#eq:unifprim">(3.5)</a> to give the discrete censored delay distribution for uniformly distributed primary event times:</p>
<p><span class="math display" id="eq:disccensunifprim">\[
\begin{aligned}
f_n &amp;= \Delta_1\Big[(n-1) \Delta_1F_T(n-1)\Big] - \Delta_1Q_T(n) - \Delta_1\Big[ \int_{n-1}^n f_T(z) z ~dz \Big] \\
&amp;= (n+1)F_T(n+1)  + (n-1)F_T(n-1) - 2nF_T(n) - \Delta_1\Big[ \int_{n-1}^n f_T(z) z ~dz \Big].
\end{aligned}  \tag{3.7}
\]</span></p>
<p>We now consider some specific delay distributions.</p>
<div class="section level5" number="3.2.1.1">
<h5 id="gamma-distributed-delay-times">
<span class="header-section-number">3.2.1.1</span> Gamma distributed delay times<a class="anchor" aria-label="anchor" href="#gamma-distributed-delay-times"></a>
</h5>
<p>The Gamma distribution has the density function:</p>
<p><span class="math display">\[
f_T(z;k, \theta) = {1 \over \Gamma(k) \theta^k} z^{k-1} \exp(-z/\theta).
\]</span>
Where <span class="math inline">\(\Gamma\)</span> is the Gamma function.</p>
<p>The Gamma distribution has the distribution function:</p>
<p><span class="math display">\[
\begin{aligned}
F_T(z;k, \theta) &amp;= {\gamma(k, z/\theta) \over \Gamma(k)}, \qquad z\geq 0,\\
F_T(z;k, \theta) &amp;= 0, \qquad z &lt; 0.
\end{aligned}
\]</span>
Where <span class="math inline">\(\gamma\)</span> is the lower incomplete gamma function.</p>
<p><strong>Gamma partial expectation</strong></p>
<p>We know that the full expectation of the Gamma distribution is <span class="math inline">\(\mathbb{E}[T] = k\theta\)</span>, which can be calculated as a standard integral. Doing the same integral for the partial expectation gives:</p>
<p><span class="math display" id="eq:gammapartexp">\[
\begin{aligned}
\int_t^{t+w_P} f_T(z) z~ dz &amp;= {1 \over \Gamma(k) \theta^k} \int_t^{t+w_P}z z^{k-1} \exp(-z/\theta)~dz \\
&amp;=  {\Gamma(k+1) \theta^{k+1} \over \Gamma(k) \theta^k}  {1 \over \Gamma(k+1) \theta^{k+1}} \int_t^{t+w_P}z^{k} \exp(-z/\theta)~dz\\
&amp;= k\theta \Delta_{w_P} F_T(t; k + 1, \theta).
\end{aligned} \tag{3.8}
\]</span></p>
<p><strong>Survival function of <span class="math inline">\(S_{+}\)</span> for Gamma distribution</strong></p>
<p>By substituting equation <a href="#eq:gammapartexp">(3.8)</a> into equation <a href="#eq:disccensunifprim">(3.7)</a> we can solve for the survival function of <span class="math inline">\(S_+\)</span> in terms of analytically available functions:</p>
<p><span class="math display" id="eq:survgammaunifprim">\[
\begin{aligned}
Q_{S_+}(t; k, \theta) &amp;= Q_T(t + w_P; k, \theta) + { 1 \over w_P} \left( {1 \over \Gamma(k) \theta^k} \int_t^{t+w_P} z^{k-1}  \exp(-z/\theta) (z-t)~ dz \right), \\
&amp;= Q_T(t + w_P; k, \theta) + { 1 \over w_P} \big[ k \theta \Delta_{w_P}F_T(t; k+1, \theta) - t \Delta_{w_P}F_T(t; k, \theta) \big].
\end{aligned} \tag{3.9}
\]</span></p>
<p><strong>Gamma discrete censored delay distribution</strong></p>
<p>By substituting <a href="#eq:survgammaunifprim">(3.9)</a> into <a href="#eq:disccensprob">(3.3)</a> we get the discrete censored delay distribution in terms of analytically available functions:
<span class="math display">\[
\begin{aligned}
f_n &amp;= (n+1) F_T(n+1; k, \theta) + (n-1) F_T(n-1; k, \theta) - 2  n F_T(n; k, \theta) - k \theta \Delta_1^{(2)}F_T(n-1; k+1, \theta)\\
&amp;= (n+1) F_T(n+1; k, \theta) + (n-1) F_T(n-1; k, \theta) - 2  n F_T(n; k, \theta) \\
&amp;+ k \theta \Big( 2 F_T(n; k+1, \theta) - F_T(n-1; k+1, \theta) - F_T(n+1; k+1,\theta)  \Big) \qquad n = 0, 1, \dots.
\end{aligned}
\]</span></p>
<p>Which was also found by Cori <em>et al</em><span class="citation"><sup>[<a href="#ref-cori2013new">4</a>]</sup></span>.</p>
</div>
<div class="section level5" number="3.2.1.2">
<h5 id="log-normal-distribution">
<span class="header-section-number">3.2.1.2</span> Log-Normal distribution<a class="anchor" aria-label="anchor" href="#log-normal-distribution"></a>
</h5>
<p>The Log-Normal distribution has the density function:</p>
<p><span class="math display">\[
f_T(z;\mu, \sigma) = {1 \over z \sigma \sqrt{2\pi}} \exp\left( - {(\log(z) - \mu)^2 \over 2 \sigma^2} \right).
\]</span>
And distribution function:</p>
<p><span class="math display">\[
F_T(z;\mu, \sigma) = \Phi\left( {\log(z) - \mu \over \sigma} \right).
\]</span>
Where <span class="math inline">\(\Phi\)</span> is the standard normal distribution function.</p>
<p><strong>Log-Normal partial expectation</strong></p>
<p>We know that the full expectation of the Log-Normal distribution is <span class="math inline">\(\mathbb{E}[T] = e^{\mu + \frac{1}{2} \sigma^2}\)</span>, which can be calculated by integration with the integration substitution <span class="math inline">\(y = (\ln z - \mu) / \sigma\)</span>. This has transformation Jacobian:</p>
<p><span class="math display">\[
\frac{dz}{dy} = \sigma e^{\sigma y + \mu}.
\]</span></p>
<p>Doing the same integral for the partial expectation, and using the same integration substitution gives:</p>
<p><span class="math display" id="eq:lognormpartexp">\[
\begin{aligned}
\int_t^{t+w_P} z~ f_T(z; \mu, \sigma) dz &amp;= {1 \over \sigma \sqrt{2\pi}} \int_t^{t+w_P}  \exp\left( - {(\log(z) - \mu)^2 \over 2 \sigma^2} \right) dz \\
&amp;= {1 \over \sqrt{2\pi}} \int_{(\ln t - \mu)/\sigma}^{(\ln(t+w_P) - \mu)/\sigma} e^{\sigma y + \mu} e^{-y^2/2} dy\\
&amp;= {e^{\mu + \frac{1}{2} \sigma^2} \over \sqrt{2 \pi} } \int_{(\ln t - \mu)/\sigma}^{(\ln(t+w_P) - \mu)/\sigma} e^{-(y- \sigma)^2/2} dy \\
&amp;= e^{\mu + \frac{1}{2} \sigma^2} \Big[\Phi\Big({\ln(t+w_P) - \mu \over \sigma} - \sigma\Big) - \Phi\Big({\ln(t) - \mu \over \sigma} - \sigma\Big) \Big]\\
&amp;= e^{\mu + \frac{1}{2} \sigma^2} \Delta_{w_P}F_T(t; \mu + \sigma^2, \sigma).
\end{aligned} \tag{3.10}
\]</span></p>
<p><strong>Survival function of <span class="math inline">\(S_{+}\)</span> for Log-Normal distribution</strong></p>
<p>By substituting equation <a href="#eq:lognormpartexp">(3.10)</a> into equation <a href="#eq:disccensunifprim">(3.7)</a> we can solve for the survival function of <span class="math inline">\(S_+\)</span> in terms of analytically available functions:</p>
<p><span class="math display">\[
\begin{aligned}
Q_{S+}(t ;\mu, \sigma) &amp;= Q_T(t + w_P;\mu, \sigma) + { 1 \over w_P} \int_t^{t+w_P} {1 \over z \sigma \sqrt{2\pi}} \exp\left( - {(\log(z) - \mu)^2 \over 2 \sigma^2} \right) (z-t)~ dz, \\
&amp;= Q_T(t + w_P;\mu, \sigma) + { 1 \over w_P} \Big[ e^{\mu + \frac{1}{2} \sigma^2} \Delta_{w_P}F_T(t; \mu + \sigma^2, \sigma) - t\Delta_{w_P}F_T(t; \mu, \sigma) \Big]
\end{aligned}
\]</span></p>
<p><strong>Log-Normal discrete censored delay distribution</strong></p>
<p>By substituting <a href="#eq:lognormpartexp">(3.10)</a> into <a href="#eq:disccensprob">(3.3)</a> we get the discrete censored delay distribution in terms of analytically available functions:</p>
<p><span class="math display">\[
\begin{aligned}
f_n &amp;= (n+1) F_T(n+1; \mu, \sigma) + (n-1) F_T(n-1; \mu, \sigma) - 2 n F_T(n; \mu, \sigma) \\
&amp;- e^{\mu + \frac{1}{2} \sigma^2} \Delta_1^{(2)}F_T(n-1;\mu + \sigma^2, \sigma) \\
&amp;= (n+1) F_T(n+1; \mu, \sigma) + (n-1) F_T(n-1; \mu, \sigma) - 2 n F_T(n; \mu, \sigma) \\
  &amp;+ e^{\mu + \frac{1}{2} \sigma^2} \Big( 2 F_T(n; \mu + \sigma^2, \sigma) - F_T(n+1; \mu + \sigma^2, \sigma) - F_T(n-1; \mu + \sigma^2, \sigma)  \Big)\qquad n = 0, 1, \dots.
\end{aligned}
\]</span></p>
</div>
<div class="section level5" number="3.2.1.3">
<h5 id="weibull-distribution">
<span class="header-section-number">3.2.1.3</span> Weibull distribution<a class="anchor" aria-label="anchor" href="#weibull-distribution"></a>
</h5>
<p>The Weibull distribution has the density function:</p>
<p><span class="math display">\[
f_T(z;\lambda,k) =
\begin{cases}
\frac{k}{\lambda}\left(\frac{z}{\lambda}\right)^{k-1}e^{-(z/\lambda)^{k}}, &amp; z\geq0 ,\\
0, &amp; z&lt;0,
\end{cases}
\]</span>
And distribution function:</p>
<p><span class="math display">\[
F_T(z;\lambda,k))=\begin{cases}1 - e^{-(z/\lambda)^k}, &amp; z\geq0,\\ 0, &amp; z&lt;0.\end{cases}
\]</span>
Where <span class="math inline">\(\Phi\)</span> is the standard normal distribution function.</p>
<p><strong>Weibull partial expectation</strong></p>
<p>We know that the full expectation of the Weibull distribution is <span class="math inline">\(\mathbb{E}[T] = \lambda \Gamma(1 + 1/k)\)</span>, which can be calculated by integration using the integration substitution <span class="math inline">\(y = (z / \lambda)^k\)</span>, which has transformation Jacobian:</p>
<p><span class="math display">\[
\frac{dz}{dy} = \frac{\lambda}{k}y^{1/k - 1}.
\]</span></p>
<p>Doing the same integral for the partial expectation, and using the same integration substitution gives:</p>
<p><span class="math display" id="eq:weibullpartexp">\[
\begin{aligned}
\int_t^{t+w_P} z~ f_T(z; \lambda,k) dz  &amp;= \int_t^{t+w_P} \frac{kz}{\lambda}\left(\frac{z}{\lambda}\right)^{k-1}e^{-(z/\lambda)^{k}} dz \\
&amp;= k\int_t^{t+w_P} \left(\frac{z}{\lambda}\right)^{k}e^{-(z/\lambda)^{k}} dz  \\
&amp;= \lambda k \int_{(t / \lambda)^k}^{((t + w_P) / \lambda)^k} y y^{1/k - 1} e^{-y} dy  \\
&amp;= \lambda\int_{(t / \lambda)^k}^{((t + w_P) / \lambda)^k} y^{1/k} e^{-y} dy\\
&amp;= \lambda \Delta_{w_P} g(t; \lambda,k)
\end{aligned} \tag{3.11}
\]</span></p>
<p>Where</p>
<p><span class="math display">\[
g(t; \lambda, k) = \gamma(1 + 1/k, (t/\lambda)^k) = \frac{1}{k}\gamma(1/k, (t/\lambda)^k) - \frac{t}{\lambda}e^{-(t/\lambda)^k}.
\]</span>
is a reparametrisation of the lower incomplete gamma function.</p>
<p><strong>Survival function of <span class="math inline">\(S_{+}\)</span> for Weibull distribution</strong></p>
<p>By substituting equation <a href="#eq:weibullpartexp">(3.11)</a> into equation <a href="#eq:disccensunifprim">(3.7)</a> we can solve for the survival function of <span class="math inline">\(S_+\)</span> in terms of analytically available functions:</p>
<p><span class="math display">\[
Q_{S+}(t ;\lambda,k) = Q_T(t + w_P; \lambda,k) + { 1 \over w_P} \Big[ \lambda \Delta_{w_P} g(t; \lambda,k) - t\Delta_{w_P}F_T(t; \lambda,k)\Big].
\]</span></p>
<p><strong>Weibull discrete censored delay distribution</strong></p>
<p>By substituting <a href="#eq:weibullpartexp">(3.11)</a> into <a href="#eq:disccensprob">(3.3)</a> we get the discrete censored delay distribution in terms of analytically available functions:</p>
<p><span class="math display">\[
\begin{aligned}
f_n &amp;= (n+1)F_T(n+1)  + (n-1)F_T(n-1) - 2nF_T(n) - \Delta_1\Big[ \int_{n-1}^n f_T(z) z ~dz \Big] \\
&amp;= (n+1)F_T(n+1)  + (n-1)F_T(n-1) - 2nF_T(n) - \lambda \Delta_1^{(2)} g(n-1; \lambda,k) \\
&amp;= (n+1)F_T(n+1)  + (n-1)F_T(n-1) - 2nF_T(n) \\
&amp;+ \lambda [2 g(n; \lambda,k) - g(n+1; \lambda,k) - g(n-1; \lambda,k)] \qquad n = 0, 1, \dots.
\end{aligned}
\]</span></p>
<p>Which was also found by Cori <em>et al</em><span class="citation"><sup>[<a href="#ref-cori2013new">4</a>]</sup></span>.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-leung1997censoring" class="csl-entry">
1. Leung, K.-M., Elashoff, R. M., &amp; Afifi, A. A. (1997). Censoring issues in survival analysis. <em>Annual Review of Public Health</em>, <em>18</em>(1), 83–104.
</div>
<div id="ref-Park2024" class="csl-entry">
2. Park, S. W., Akhmetzhanov, A. R., Charniga, K., Cori, A., Davies, N. G., Dushoff, J., Funk, S., Gostic, K., Grenfell, B., Linton, N. M., Lipsitch, M., Lison, A., Overton, C. E., Ward, T., &amp; Abbott, S. (2024). Estimating epidemiological delay distributions for infectious diseases. <em>bioRxiv</em>. <a href="https://doi.org/10.1101/2024.01.12.24301247" class="external-link">https://doi.org/10.1101/2024.01.12.24301247</a>
</div>
<div id="ref-Charniga2024" class="csl-entry">
3. Charniga, K., Park, S. W., Akhmetzhanov, A. R., Cori, A., Dushoff, J., Funk, S., Gostic, K. M., Linton, N. M., Lison, A., Overton, C. E., Pulliam, J. R. C., Ward, T., Cauchemez, S., &amp; Abbott, S. (2024). Best practices for estimating and reporting epidemiological delay distributions of infectious diseases using public health surveillance and healthcare data. <em>arXiv [Stat.ME]</em>. <a href="https://arxiv.org/abs/2405.08841" class="external-link">https://arxiv.org/abs/2405.08841</a>
</div>
<div id="ref-cori2013new" class="csl-entry">
4. Cori, A., Ferguson, N. M., Fraser, C., &amp; Cauchemez, S. (2013). A new framework and software to estimate time-varying reproduction numbers during epidemics. <em>American Journal of Epidemiology</em>, <em>178</em>(9), 1505–1512.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Sam Brand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
